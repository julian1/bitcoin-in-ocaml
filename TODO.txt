
todo
  - get micro-ecc working with native code library linking

  - store received blocks in queue, rather than blocking on the db writing, also automatic re-read 

  - get full script evaluation working, not just sig-checking

  - lots of old filedescriptors in list, when they're probably not active. 
  - fix our single entry packing of the inv request, which means we can't progress if the 
      only leaf is an orphaned block. 

  - issue - inventory tx cannot be cleared when block is produced, because a chainstate reoganisation could
    mean that block becomes orphaned. 

  - get rid of caml case functions in message.ml

  - test for tx ecc checking. prev

  - finish wif
  - compute difficuly in relation to block time, so we can test against block difficulty
      - select * from _height where height % 2016 = 0;
      - we don't really want to store something that's a dynamic calc (like height or difficulty)
      - but we can't do expensive sql queries for each block ...

  - store peers in db for easy resumption
      - could set initial peer via command line. if wanted.

  - connect to doge network

  - with 500k blocks - selecting _leaves is 200ms, selecting with height (_leaves2) 4700ms = 20x more expensive
      - it may make sense to record height - especially if we record difficulty
      - counter argument - getting list of blocks in main chain will always be slow due to recursive
        cte parent_id function 

  - Consider using Zarith values instead of Int64 ...
  - refactor util and put app state in its own module 


  - done - not null on main columns 
  - done - organize with foreign keys first
  - done put unique constraint on tx hash 
  - done add a mapping table between 
  - done rename views to use prefix underscores
  - done - store the sigtype in signature
  - done move the tx pos, length into the tx_block structure, maybe also add blockdata id... no 
  - done - get rid of blockdata? since it's one-to-one with block?  
      - no - because allows non-null enforcement and might be faster
  - done record pos, len in output, starting from 0 in tx and check 
  - done maybe same for input
  - done lookup the tx before insert to see if already have it
  - done - the blockdata i think should point at block. rather than block at blockdata. 
      because for the first query hash there will be no blockdata. 
  - done - and previous should be a separate table.

  - done - whether a block is mainnet, or orphaned or testnet is a dynamic property - now db.
  - done - move address test stuff in /test dir?
  - done - test for block header decode 
  - done - we've got to get test code, extracted and working 
  - done - decode difficulty, - can use either floating point, or z. float will be eaiser 
  - done - merkle root / tree
  - done weight the p2p leave selection in favor of longest chain
      if random.int 4 < 3 pick... else pick next...
  - done we're getting tx's recorded twice, because they're in an orphaned block
      (should be fixed with _main and _tx views)
  - done - connect to ltc network

old
  - http/or cli interface to examine the read-only structures now, so
    it's not really necessary to dump state everytime.

  - simplify address storing in process_block not to use complicated prepared stmt 
  - change var name 'x' to acc or something

  - maybe an module encapsulation of the String, Z, hex representation for hashes 
    - with functions for Z or sha hashing or private/pub key, hex formatting  etc.
    - rather than converting everything around in code when needed.

----

----
issues

  transaction malleability and removing items from mempool??? how? 
    probably just record the block one, then the mempool one utxos will be spent
----
   - note that tx data may be stored twice in two forked blocks. we get it correctly... 
  - meaning it may appear more than once...

  - ok, there's an issue that tx data might be in block, or somewhere else
    makes it har

---
  change name process_block to store_block ?

  - IMPORTANT should move the transaction isolation begin and commit outside the process block
    so that if want to do other actions - like check if block has been inserted in the same
    tx we can.

